---
layout: post
category: CSAPP
slug: hr example
title: 虚拟内存
---

# Virtual memory Concepts

---

## 虚拟化

通过干预或介入对资源的访问实现资源的`虚拟化`。比如**磁盘**在物理上是由柱面、磁道、扇区、盘面构成的，事实上需要为上述物理位置分别指定编号 才能访问磁盘的具体位置。但是**磁盘控制器**通过拦截并处理来自操作系统的磁盘读写请求为操作系统提供了一个虚拟化的视图，将操作系统提供的逻辑块号转换为实际的物理地址。

---

## 虚拟内存

- **Linear address space**: Ordered set of contiguous non-negative integer addresses:

$$
\{0,1,2,3,\dots \}
$$

线性地址空间指的是一段连续的非负整数，表示地址的集合，而不是字节的集合

- **Virtual address space**: Set of $N=2^n$  virtual addresses

$$
\{0,1,2,3,\dots,N-1\}
$$

虚拟地址空间是包含 $ N=2^n $ 个虚拟地址的集合，是线性地址空间。所有进程虚拟地址空间相同

- **Physical address space**: Set of $ M=2^m $ physical  addresses 

$$
\{0,1,2,3,\dots,M-1\}
$$

物理地址空间对应系统中实际拥有的DRAM容量

### 虚拟内存的意义

- **更有效率地使用主存。把主存当作虚拟内存的高速缓冲。**一个缓冲块是一个页（一般4096字节，太小总是要换，太大换得太慢）。

![](../../www/assets/pic/1.png)

虚拟内存中有的块被实际加载到了内存，有的没有。甚至有的块还没有被分配实际的地址。

CPU生成虚拟地址，交给MMU(Memory Management  Unit)，MMU去页表(Page Table  Entrry)查找。

页表是一个索引到值的映射表格。索引是虚拟地址，值是物理页的编号（如果这个物理页在内存中，即Page Hit）或者是一个指向硬盘(disk)地址的指针。



全向联，每个页面可被缓存到任何位置。

- 简化进程的内存管理，每个进程都可以当作自己独占内存空间
- 分割进程的地址空间
  - 一个进程不能访问其他进程
  - 用户进程不能访问内核

